<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>学员端 - 我的账户</title>
  <style>
    body { margin: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f5f7fa; }
    .topbar { height: 60px; background: white; display: flex; align-items: center; justify-content: space-between; padding: 0 20px; border-bottom: 1px solid #ddd; }
    .topbar h3 { margin: 0; color: #333; }
    .topbar button { background: #ff512f; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; }
    .topbar button:hover { background: #d63c20; }
    .container { padding: 20px; max-width: 900px; margin: auto; }
    .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-bottom: 20px; }
    .card h4 { margin: 0 0 15px; color: #ff512f; }
    .balance { font-size: 22px; color: #333; margin-bottom: 10px; }
    .recharge-box input, .recharge-box select, .recharge-box button { padding: 8px; margin: 5px; border: 1px solid #ddd; border-radius: 6px; }
    .recharge-box button { background: #ff512f; color: white; cursor: pointer; }
    .recharge-box button:hover { background: #d63c20; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { padding: 10px; border: 1px solid #ddd; text-align: center; font-size: 14px; }
    th { background: #f2f2f2; }
  </style>
</head>
<body>
  <!-- 顶部栏 -->
  <div class="topbar">
    <h3>乒乓球培训管理系统 - 学员端</h3>
    <button onclick="back()">返回主页</button>
  </div>

  <!-- 主体内容 -->
  <div class="container">
    <!-- 账户余额 -->
    <div class="card">
      <h4>账户余额</h4>
      <div class="balance" id="balance">￥0.00</div>
    </div>

    <!-- 充值功能 -->
    <div class="card recharge-box">
      <h4>充值</h4>
      <input type="number" id="amount" placeholder="输入充值金额">
      <select id="method">
        <option value="wechat">微信支付</option>
        <option value="alipay">支付宝支付</option>
        <option value="offline">线下支付</option>
      </select>
      <button onclick="recharge()">确认充值</button>
    </div>

    <!-- 交易记录 -->
    <div class="card">
      <h4>交易记录</h4>
      <table>
        <thead>
          <tr>
            <th>时间</th>
            <th>类型</th>
            <th>金额</th>
            <th>备注</th>
          </tr>
        </thead>
        <tbody id="transactions">
          <tr><td colspan="4">暂无记录</td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <script>
    function back() {
      window.location.href = "/student-dashboard";
    }

    async function loadAccount() {
      const res = await fetch("/api/student/account");
      const data = await res.json();
      document.getElementById("balance").textContent = "￥" + data.balance.toFixed(2);

      const tbody = document.getElementById("transactions");
      tbody.innerHTML = "";
      if (!data.transactions || data.transactions.length === 0) {
        tbody.innerHTML = "<tr><td colspan='4'>暂无记录</td></tr>";
      } else {
        data.transactions.forEach(t => {
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td>${t.time}</td>
            <td>${t.type}</td>
            <td>${t.amount}</td>
            <td>${t.note || ""}</td>
          `;
          tbody.appendChild(tr);
        });
      }
    }

    async function recharge() {
      const amount = document.getElementById("amount").value;
      const method = document.getElementById("method").value;
      if (!amount || amount <= 0) {
        alert("请输入正确的充值金额");
        return;
      }
      const res = await fetch("/api/student/recharge", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ amount, method })
      });
      const data = await res.json();
      alert(data.message);
      loadAccount();
    }

    loadAccount();
  </script>
</body>
</html>
